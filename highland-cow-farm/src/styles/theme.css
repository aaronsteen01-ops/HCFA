:root {
      --bg: #fef8ff;
      --bg-alt: rgba(255, 255, 255, 0.94);
      --text: #3d2b4f;
      --text-muted: #77688d;
      --accent: #f5a6c8;
      --accent-strong: #f07fb0;
      --accent-contrast: #fff2f8;
      --outline: rgba(61, 43, 79, 0.14);
      --success: #8ed1b0;
      --warning: #fcd68a;
      --danger: #f78c82;
      --card-radius: 26px;
      --card-shadow: 0 24px 48px rgba(97, 73, 116, 0.16);
      --card-highlight: inset 0 1px 0 rgba(255, 255, 255, 0.82);
      --transition: 0.25s ease;
      --sky-top: #fff2fa;
      --sky-bottom: #d6efff;
      --sky-glow: rgba(254, 214, 241, 0.72);
      --field-main: #d8f5e0;
      --field-highlight: #c9efd6;
      --hill-shadow: #b4e4cc;
      --cloud-color: rgba(255, 255, 255, 0.92);
      --cow-colour-rose-bg: linear-gradient(140deg, rgba(255, 236, 246, 0.95) 0%, rgba(244, 188, 213, 0.75) 100%);
      --cow-colour-rose-border: rgba(239, 153, 197, 0.6);
      --cow-colour-rose-glow: rgba(239, 153, 197, 0.4);
      --cow-colour-cream-bg: linear-gradient(140deg, rgba(255, 251, 235, 0.95) 0%, rgba(240, 221, 184, 0.7) 100%);
      --cow-colour-cream-border: rgba(224, 194, 140, 0.55);
      --cow-colour-cream-glow: rgba(224, 194, 140, 0.35);
      --cow-colour-brown-bg: linear-gradient(140deg, rgba(244, 230, 215, 0.95) 0%, rgba(210, 177, 147, 0.72) 100%);
      --cow-colour-brown-border: rgba(186, 146, 109, 0.55);
      --cow-colour-brown-glow: rgba(186, 146, 109, 0.32);
      --cow-colour-chocolate-bg: linear-gradient(140deg, rgba(240, 223, 215, 0.95) 0%, rgba(194, 161, 156, 0.72) 100%);
      --cow-colour-chocolate-border: rgba(170, 124, 118, 0.55);
      --cow-colour-chocolate-glow: rgba(170, 124, 118, 0.34);
      --cow-colour-white-bg: linear-gradient(140deg, rgba(255, 255, 255, 0.95) 0%, rgba(231, 240, 255, 0.75) 100%);
      --cow-colour-white-border: rgba(180, 195, 226, 0.55);
      --cow-colour-white-glow: rgba(180, 195, 226, 0.32);
      color-scheme: only light;
    }

    body.high-contrast,
    body.hc-high-contrast {
      --bg: #ffffff;
      --bg-alt: #f4f4f4;
      --text: #111111;
      --text-muted: #2d2d2d;
      --accent: #276ef1;
      --accent-strong: #1747a3;
      --accent-contrast: #eaf1ff;
      --outline: rgba(17, 17, 17, 0.3);
      --success: #14804b;
      --warning: #af6300;
      --danger: #c02020;
      --sky-top: #f7f8fb;
      --sky-bottom: #d7e2fb;
      --sky-glow: rgba(223, 237, 255, 0.8);
      --field-main: #d2e4cc;
      --field-highlight: #bed6bc;
      --hill-shadow: #97c29b;
      --cloud-color: #ffffff;
      --cow-colour-rose-bg: linear-gradient(180deg, #fff7fb 0%, #ffd6ea 100%);
      --cow-colour-rose-border: #b83280;
      --cow-colour-rose-glow: rgba(184, 50, 128, 0.55);
      --cow-colour-cream-bg: linear-gradient(180deg, #fffbe8 0%, #ffdca4 100%);
      --cow-colour-cream-border: #b78000;
      --cow-colour-cream-glow: rgba(183, 128, 0, 0.5);
      --cow-colour-brown-bg: linear-gradient(180deg, #f8eddf 0%, #d9b48a 100%);
      --cow-colour-brown-border: #7a4a11;
      --cow-colour-brown-glow: rgba(122, 74, 17, 0.5);
      --cow-colour-chocolate-bg: linear-gradient(180deg, #f6e6e0 0%, #c48a86 100%);
      --cow-colour-chocolate-border: #88424f;
      --cow-colour-chocolate-glow: rgba(136, 66, 79, 0.52);
      --cow-colour-white-bg: linear-gradient(180deg, #ffffff 0%, #e3ecff 100%);
      --cow-colour-white-border: #4865c2;
      --cow-colour-white-glow: rgba(72, 101, 194, 0.48);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Nunito", "Segoe UI", system-ui, -apple-system, sans-serif;
      background-color: var(--bg);
      background-image:
        radial-gradient(160% 140% at 50% 0%, rgba(255, 218, 242, 0.42) 0%, transparent 68%),
        radial-gradient(120% 150% at 50% 65%, rgba(204, 232, 255, 0.22) 0%, transparent 82%),
        linear-gradient(180deg, var(--sky-top) 0%, var(--sky-bottom) 55%, var(--field-highlight) 72%, var(--field-main) 100%);
      background-repeat: no-repeat;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px;
      transition: background-color var(--transition), color var(--transition);
      position: relative;
      overflow-x: hidden;
    }

    body[data-season='spring-bloom'] {
      --sky-glow: rgba(254, 214, 241, 0.82);
      --accent: #f3a7d1;
      --accent-strong: #eb7ab3;
    }

    body[data-season='harvest-tide'] {
      --accent: #f3b15c;
      --accent-strong: #d8892d;
      --sky-glow: rgba(255, 210, 160, 0.7);
    }

    .season-event {
      margin-top: 8px;
    }

    .season-event strong {
      display: block;
      margin-bottom: 4px;
    }

    .season-task-list {
      margin: 6px 0 0;
      padding-left: 18px;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    body::before,
    body::after {
      content: "";
      position: absolute;
      left: -20vw;
      right: -20vw;
      pointer-events: none;
      z-index: 0;
    }

    body::before {
      bottom: -8vh;
      height: clamp(260px, 42vh, 420px);
      background:
        radial-gradient(60% 80% at 20% 100%, var(--field-highlight) 0%, transparent 70%),
        radial-gradient(70% 90% at 80% 100%, var(--hill-shadow) 0%, transparent 75%);
      opacity: 0.85;
    }

    body::after {
      bottom: -16vh;
      height: clamp(320px, 56vh, 520px);
      background: radial-gradient(80% 100% at 50% 100%, var(--field-main) 0%, transparent 75%);
      opacity: 0.7;
    }

    .scene-frame {
      position: relative;
      z-index: 1;
      width: min(960px, 100%);
    }

    .scene-decoration {
      position: absolute;
      top: -180px;
      left: -240px;
      width: calc(100% + 480px);
      height: 260px;
      pointer-events: none;
      z-index: 0;
      overflow: visible;
    }

    .scene-decoration .cloud {
      --cloud-scale: 1;
      --cloud-duration: 70s;
      position: absolute;
      top: 0;
      left: -35%;
      width: 180px;
      height: 70px;
      background: var(--cloud-color);
      border-radius: 999px;
      opacity: 0.85;
      filter: drop-shadow(0 16px 32px rgba(53, 38, 77, 0.15));
      transform: scale(var(--cloud-scale));
      animation: cloud-drift var(--cloud-duration) linear infinite;
    }

    .scene-decoration .cloud::before,
    .scene-decoration .cloud::after {
      content: "";
      position: absolute;
      background: var(--cloud-color);
      border-radius: 50%;
    }

    .scene-decoration .cloud::before {
      width: 90px;
      height: 60px;
      left: -28px;
      top: 10px;
    }

    .scene-decoration .cloud::after {
      width: 80px;
      height: 55px;
      right: -25px;
      top: 16px;
    }

    .scene-decoration .cloud--one {
      top: 20px;
      --cloud-duration: 68s;
      --cloud-scale: 1.05;
    }

    .scene-decoration .cloud--two {
      top: 60px;
      --cloud-duration: 74s;
      --cloud-scale: 0.85;
      opacity: 0.8;
      animation-delay: -24s;
    }

    .scene-decoration .cloud--three {
      top: 100px;
      --cloud-duration: 80s;
      --cloud-scale: 1.2;
      opacity: 0.75;
      animation-delay: -48s;
    }

    .scene-decoration .bird {
      --bird-duration: 36s;
      position: absolute;
      top: 140px;
      left: -12%;
      width: 36px;
      height: 18px;
      color: var(--text-muted);
      opacity: 0.6;
      animation: bird-glide var(--bird-duration) linear infinite;
    }

    .scene-decoration .bird::before,
    .scene-decoration .bird::after {
      content: "";
      position: absolute;
      width: 18px;
      height: 12px;
      border-top: 2px solid currentColor;
      border-radius: 50% 50% 0 0;
      top: 0;
    }

    .scene-decoration .bird::before {
      left: 0;
      transform: rotate(-18deg);
    }

    .scene-decoration .bird::after {
      right: 0;
      transform: rotate(18deg);
    }

    .scene-decoration .bird--one {
      top: 80px;
      --bird-duration: 34s;
      animation-delay: -8s;
    }

    .scene-decoration .bird--two {
      top: 130px;
      --bird-duration: 42s;
      animation-delay: -18s;
    }

    @keyframes cloud-drift {
      from {
        left: -35%;
      }
      to {
        left: 110%;
      }
    }

    @keyframes bird-glide {
      from {
        left: -12%;
        transform: translateY(0);
      }
      50% {
        left: 55%;
        transform: translateY(-6px);
      }
      to {
        left: 112%;
        transform: translateY(0);
      }
    }

    main {
      width: min(960px, 100%);
      background: var(--bg-alt);
      border-radius: 28px;
      box-shadow: 0 20px 60px rgba(53, 38, 77, 0.15);
      padding: clamp(16px, 3vw, 40px);
      display: flex;
      flex-direction: column;
      gap: 24px;
      position: relative;
      z-index: 1;
      overflow: hidden;
    }

    main::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background:
        radial-gradient(120% 120% at 50% 0%, rgba(255, 255, 255, 0.55) 0%, rgba(255, 255, 255, 0) 65%),
        radial-gradient(150% 120% at 50% 100%, rgba(242, 169, 183, 0.22) 0%, rgba(255, 255, 255, 0) 75%);
      pointer-events: none;
      z-index: 0;
    }

    body.high-contrast main::before,
    body.hc-high-contrast main::before {
      background: none;
    }

    main > * {
      position: relative;
      z-index: 1;
    }

    h1, h2, h3, h4 {
      margin: 0;
      font-weight: 700;
      color: var(--text);
    }

    p {
      color: var(--text-muted);
      line-height: 1.6;
      margin: 0 0 0.75rem;
    }

    button {
      background: var(--accent);
      color: var(--text);
      border: none;
      border-radius: 999px;
      padding: 0.75rem 1.6rem;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
      box-shadow: 0 12px 24px rgba(242, 169, 183, 0.35);
      position: relative;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(242, 169, 183, 0.45);
    }

    button:focus-visible {
      transform: translateY(-1px);
      outline: 2px solid var(--accent-strong);
      outline-offset: 2px;
      box-shadow: 0 18px 36px rgba(242, 169, 183, 0.5);
    }

    body.high-contrast button:focus-visible,
    body.hc-high-contrast button:focus-visible {
      outline-color: var(--text);
      box-shadow: 0 0 0 2px var(--accent-contrast);
    }

    button.secondary {
      background: var(--accent-contrast);
      color: var(--accent-strong);
      box-shadow: none;
      border: 2px solid var(--accent);
    }

    button.ghost {
      background: transparent;
      color: var(--text-muted);
      box-shadow: none;
      border: 2px dashed var(--outline);
    }

    button.danger {
      background: var(--danger);
      color: #fff;
      box-shadow: 0 12px 22px rgba(244, 135, 109, 0.45);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .screen {
      display: none;
      flex-direction: column;
      gap: 20px;
      animation: fade-in 0.35s ease;
    }

    .screen.active {
      display: flex;
    }

    @keyframes fade-in {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .title-hero {
      display: grid;
      gap: 18px;
    }

    .title-hero svg {
      width: clamp(160px, 40vw, 280px);
      align-self: center;
      filter: drop-shadow(0 12px 22px rgba(53, 38, 77, 0.12));
    }

    .options-list {
      display: grid;
      gap: 16px;
    }

    .toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      border-radius: 18px;
      border: 2px solid var(--outline);
      background: var(--bg);
    }

    .toggle label {
      font-weight: 600;
    }

    .toggle input[type="checkbox"] {
      width: 46px;
      height: 26px;
      border-radius: 999px;
      border: 2px solid var(--accent);
      appearance: none;
      background: var(--accent-contrast);
      position: relative;
      cursor: pointer;
      transition: background var(--transition);
    }

    .toggle input[type="checkbox"]::after {
      content: "";
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent);
      top: 2px;
      left: 2px;
      transition: transform var(--transition), background var(--transition);
    }

    .toggle input[type="range"] {
      width: 140px;
      accent-color: var(--accent);
      margin-left: 12px;
    }

    .toggle .range-value {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-left: auto;
      padding-left: 10px;
    }

    .toggle input[type="checkbox"]:checked {
      background: var(--accent);
    }

    .toggle input[type="checkbox"]:checked::after {
      transform: translateX(20px);
      background: var(--accent-contrast);
    }

    .herd-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 18px;
    }

    .cow-card {
      padding: 18px;
      border-radius: var(--card-radius);
      --cow-card-background: var(--bg);
      --cow-card-border: var(--outline);
      --cow-card-glow: rgba(138, 198, 164, 0.24);
      --cow-card-shadow-base: 0 8px 18px rgba(53, 38, 77, 0.08);
      --cow-card-shadow-outline: 0 0 0 0 transparent;
      --cow-card-shadow-glow: 0 0 0 0 transparent;
      background: var(--cow-card-background);
      border: 2px solid var(--cow-card-border);
      display: grid;
      gap: 12px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--cow-card-shadow-base), var(--cow-card-shadow-outline), var(--cow-card-shadow-glow), var(--card-highlight);
      transition: box-shadow 0.45s ease, border-color var(--transition), transform var(--transition);
      transform: translateY(0);
      isolation: isolate;
    }

    .cow-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0));
      opacity: 0.65;
      pointer-events: none;
      mix-blend-mode: screen;
      transition: opacity var(--transition);
      z-index: 0;
    }

    .cow-card:hover,
    .cow-card:focus-within {
      transform: translateY(-6px);
      box-shadow: var(--cow-card-shadow-base), 0 12px 32px rgba(97, 73, 116, 0.18), var(--cow-card-shadow-outline), var(--cow-card-shadow-glow), var(--card-highlight);
    }

    .cow-card:hover::before,
    .cow-card:focus-within::before {
      opacity: 0.8;
    }

    .cow-card[data-colour="rose"] {
      --cow-card-background: var(--cow-colour-rose-bg);
      --cow-card-border: var(--cow-colour-rose-border);
      --cow-card-glow: var(--cow-colour-rose-glow);
      --cow-card-shadow-base: 0 12px 26px rgba(239, 153, 197, 0.28);
    }

    .cow-card[data-colour="cream"] {
      --cow-card-background: var(--cow-colour-cream-bg);
      --cow-card-border: var(--cow-colour-cream-border);
      --cow-card-glow: var(--cow-colour-cream-glow);
      --cow-card-shadow-base: 0 12px 26px rgba(224, 194, 140, 0.24);
    }

    .cow-card[data-colour="brown"] {
      --cow-card-background: var(--cow-colour-brown-bg);
      --cow-card-border: var(--cow-colour-brown-border);
      --cow-card-glow: var(--cow-colour-brown-glow);
      --cow-card-shadow-base: 0 12px 26px rgba(186, 146, 109, 0.24);
    }

    .cow-card[data-colour="chocolate"] {
      --cow-card-background: var(--cow-colour-chocolate-bg);
      --cow-card-border: var(--cow-colour-chocolate-border);
      --cow-card-glow: var(--cow-colour-chocolate-glow);
      --cow-card-shadow-base: 0 12px 26px rgba(170, 124, 118, 0.24);
    }

    .cow-card[data-colour="white"] {
      --cow-card-background: var(--cow-colour-white-bg);
      --cow-card-border: var(--cow-colour-white-border);
      --cow-card-glow: var(--cow-colour-white-glow);
      --cow-card-shadow-base: 0 12px 26px rgba(180, 195, 226, 0.24);
    }

    .cow-card[data-mood="content"] {
      --cow-card-shadow-glow: 0 12px 26px var(--cow-card-glow);
    }

    .cow-card[data-mood="thriving"] {
      --cow-card-shadow-outline: 0 0 0 3px rgba(255, 255, 255, 0.65);
      --cow-card-shadow-glow: 0 16px 38px var(--cow-card-glow);
    }

    .cow-card[data-mood="hungry"] {
      --cow-card-border: rgba(247, 195, 106, 0.68);
    }

    .cow-card[data-mood="muddy"] {
      --cow-card-border: rgba(244, 135, 109, 0.65);
    }

    .cow-card[data-mood="unhappy"] {
      --cow-card-border: rgba(53, 38, 77, 0.45);
      --cow-card-shadow-base: 0 6px 14px rgba(53, 38, 77, 0.1);
    }

    body.high-contrast .cow-card {
      --cow-card-shadow-base: 0 0 0 2px var(--outline);
      --cow-card-shadow-outline: 0 0 0 0 transparent;
      --cow-card-shadow-glow: 0 0 0 0 transparent;
    }

    body.high-contrast .cow-card::before,
    body.hc-high-contrast .cow-card::before {
      opacity: 0;
    }

    body.high-contrast .cow-card[data-mood="content"] {
      --cow-card-shadow-glow: 0 0 0 10px rgba(255, 255, 255, 0.28);
    }

    body.high-contrast .cow-card[data-mood="thriving"] {
      --cow-card-shadow-outline: 0 0 0 2px var(--cow-card-glow);
      --cow-card-shadow-glow: 0 0 0 12px rgba(255, 255, 255, 0.35);
    }

    body.high-contrast .cow-card[data-mood="hungry"] {
      --cow-card-border: var(--warning);
    }

    body.high-contrast .cow-card[data-mood="muddy"] {
      --cow-card-border: var(--danger);
    }

    body.high-contrast .cow-card[data-mood="unhappy"] {
      --cow-card-border: var(--text-muted);
    }

    .cow-card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(255,255,255,0.7), transparent 70%);
      opacity: 0.7;
      pointer-events: none;
    }

    .cow-card .accessory-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: -6px;
    }

    .cow-card .accessory-chip {
      background: rgba(242, 169, 183, 0.18);
      color: var(--text);
      border-radius: 12px;
      padding: 2px 10px;
      font-size: 0.75rem;
      border: 1px solid rgba(242, 169, 183, 0.45);
    }

    .cow-card .style-btn {
      justify-self: start;
      margin-top: -4px;
      background: linear-gradient(135deg, rgba(242, 169, 183, 0.85), rgba(138, 198, 164, 0.85));
      color: #35264d;
      font-size: 0.85rem;
      padding: 0.4rem 1rem;
      box-shadow: none;
    }

    .cow-card h3 {
      font-size: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1;
    }

    .cow-card .personality {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .farm-meta {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      margin-top: 12px;
    }

    .farm-panel {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 18px;
      padding: 14px 16px;
      border: 2px solid rgba(53, 38, 77, 0.08);
      display: grid;
      gap: 10px;
    }

    .farm-panel h3 {
      font-size: 1.05rem;
      margin-bottom: 4px;
    }

    .helper-text {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin: -6px 0 10px;
    }

    .status-message {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin: -4px 0 12px;
    }

    .status-message.is-warning {
      color: var(--danger);
      font-weight: 600;
    }

    .event-list,
    .achievement-list,
    .decor-list {
      margin: 0;
      padding-left: 20px;
      color: var(--text-muted);
    }

    .event-list li + li,
    .achievement-list li + li {
      margin-top: 4px;
    }

    .event-list li strong {
      color: var(--text);
      display: block;
      font-size: 0.95rem;
    }

    .event-list li span {
      display: block;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .achievement-list li.completed::marker {
      content: "ðŸŒŸ ";
    }

    .decor-display {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 12px;
      padding: 16px;
      border-radius: 20px;
      border: 2px solid rgba(53, 38, 77, 0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(138, 198, 164, 0.18));
      position: relative;
      min-height: 140px;
    }

    .decor-display::after {
      content: "";
      position: absolute;
      inset: auto 12px 12px 12px;
      height: 32px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(138, 198, 164, 0.35), rgba(138, 198, 164, 0.05));
      z-index: 0;
    }

    .decor-slot {
      position: relative;
      z-index: 1;
      flex: 1;
      min-height: 96px;
      border-radius: 16px;
      border: 2px dashed rgba(53, 38, 77, 0.12);
      background: rgba(255,255,255,0.7);
      padding: 12px 10px 16px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      text-align: center;
      transition: border var(--transition), background var(--transition), transform var(--transition);
    }

    .decor-slot.active {
      border-style: solid;
      border-color: rgba(242, 169, 183, 0.6);
      background: rgba(242, 169, 183, 0.16);
      transform: translateY(-4px);
    }

    .decor-slot .decor-icon {
      font-size: 2rem;
      line-height: 1;
    }

    .decor-slot .decor-label {
      font-size: 0.78rem;
      margin-top: 6px;
      color: var(--text-muted);
    }

    .decor-slot .decor-placeholder {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .pantry-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      min-height: 60px;
    }

    .pantry-item {
      min-width: 72px;
      min-height: 72px;
      border-radius: 18px;
      background: rgba(242, 169, 183, 0.16);
      border: 1px solid rgba(242, 169, 183, 0.38);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1.6rem;
      color: var(--text);
      padding: 8px;
      text-align: center;
      transition: transform var(--transition);
    }

    .pantry-item span {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .pantry-item:hover {
      transform: translateY(-2px);
    }

    .cow-art {
      width: 100%;
      max-width: 220px;
      justify-self: center;
      --cow-art-base-transform: translateY(0);
      transform: var(--cow-art-base-transform);
      transition: transform 0.4s ease;
    }

    .cow-art svg {
      display: block;
      width: 100%;
      height: auto;
    }

    .cow-figure {
      overflow: visible;
    }

    .cow-figure .cow-layer {
      pointer-events: none;
      transform-box: fill-box;
      transform-origin: 50% 50%;
    }

    .cow-figure .cow-accessory {
      mix-blend-mode: normal;
    }

    .cow-figure .cow-eyes {
      opacity: 0;
      transition: opacity 120ms ease;
    }

    .cow-figure[data-eye-state='open'] .eyes-open {
      opacity: 1;
    }

    .cow-figure[data-eye-state='half'] .eyes-half {
      opacity: 1;
    }

    .cow-figure[data-eye-state='closed'] .eyes-closed {
      opacity: 1;
    }

    .cow-figure.auto-blink .eyes-open,
    .cow-figure.pose-blink .eyes-open {
      opacity: 0;
    }

    .cow-figure.auto-blink .eyes-closed,
    .cow-figure.pose-blink .eyes-closed {
      opacity: 1;
    }

    .cow-art .cow-root-group {
      transform-box: fill-box;
      transform-origin: 50% 72%;
    }

    @keyframes cowHoverBob {
      0%,
      100% {
        transform: var(--cow-art-base-transform) translateY(0) rotate(0deg);
      }
      40% {
        transform: var(--cow-art-base-transform) translateY(-4px) rotate(-0.6deg);
      }
      60% {
        transform: var(--cow-art-base-transform) translateY(-2px) rotate(0.4deg);
      }
    }

    .cow-card:hover .cow-art,
    .cow-card:focus-within .cow-art {
      animation: cowHoverBob 4.8s ease-in-out infinite;
    }

    body.high-contrast .cow-card:hover .cow-art,
    body.high-contrast .cow-card:focus-within .cow-art {
      animation: none;
    }

    @media (prefers-reduced-motion: reduce) {
      .cow-card:hover .cow-art,
      .cow-card:focus-within .cow-art {
        animation: none;
      }

      .cow-art {
        transition: none;
      }

      .cow-art--idle-wobble .cow-root-group,
      .cow-art .cow-root-group.is-idle-wobble {
        animation: none;
      }
    }

    .cow-art--idle-wobble .cow-root-group,
    .cow-art .cow-root-group.is-idle-wobble {
      animation: cowIdleWobble 4.2s ease-in-out infinite;
    }

    @keyframes cowIdleWobble {
      0%,
      100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(2.2px);
      }
    }

    .cow-card.is-chonk .cow-art {
      --cow-art-base-transform: scale(1.1) translateY(6px);
    }

    .cow-art-mini {
      max-width: 150px;
    }
    .status-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .chonk-hearts {
      font-size: 1rem;
      letter-spacing: 2px;
    }

    .task-panel {
      display: grid;
      gap: 16px;
    }

    .task-header {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.55);
      border-radius: 20px;
      padding: 12px 18px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(8px);
      box-shadow: 0 16px 32px rgba(53, 38, 77, 0.12);
    }

    body.high-contrast .task-header,
    body.hc-high-contrast .task-header {
      background: var(--bg);
      border: 2px solid var(--outline);
      backdrop-filter: none;
      box-shadow: none;
    }

    .task-header .badge {
      background: var(--accent-contrast);
      color: var(--accent-strong);
      border-radius: 999px;
      padding: 0.4rem 0.9rem;
      font-weight: 600;
    }

    .mini-subtitle {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .mini-title-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.9rem;
      height: 1.9rem;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 4px 10px rgba(53, 38, 77, 0.15);
      color: var(--accent-strong);
      font-size: 1.2rem;
    }

    body.high-contrast .mini-title-icon,
    body.hc-high-contrast .mini-title-icon {
      background: var(--bg);
      box-shadow: none;
      border: 2px solid var(--outline);
    }

    .mini-title-icon-img {
      display: block;
      width: 1.6rem;
      height: 1.6rem;
    }

    .mini-title-label {
      display: inline-flex;
      align-items: center;
    }

    .summary-icon {
      margin-right: 0.1rem;
    }

    .summary-item-text {
      margin-top: 0.35rem;
      line-height: 1.35;
    }

    .task-timer {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .mini-instruction {
      background: rgba(255, 255, 255, 0.5);
      border-radius: 20px;
      padding: 14px 18px;
      font-size: 0.95rem;
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(8px);
      box-shadow: 0 12px 26px rgba(53, 38, 77, 0.12);
    }

    body.high-contrast .mini-instruction,
    body.hc-high-contrast .mini-instruction {
      background: var(--bg);
      border: 2px solid var(--outline);
      backdrop-filter: none;
      box-shadow: none;
    }

    .minigame-area {
      min-height: 260px;
      border-radius: 24px;
      border: 3px dashed rgba(53, 38, 77, 0.12);
      background: linear-gradient(160deg, rgba(242, 169, 183, 0.1), rgba(138, 198, 164, 0.15));
      padding: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    .minigame-surface {
      width: 100%;
      height: 100%;
      display: none;
    }

    .minigame-surface.active {
      display: flex;
    }

    canvas.game-canvas {
      width: 100%;
      height: 100%;
      background: #fef9f4;
      border-radius: 20px;
      border: 2px solid rgba(53, 38, 77, 0.1);
    }

    .food-board {
      width: 100%;
      display: grid;
      gap: 18px;
    }

    .food-targets {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 14px;
    }

    .food-target {
      background: rgba(255,255,255,0.85);
      border-radius: 18px;
      padding: 12px;
      border: 2px solid rgba(53, 38, 77, 0.12);
      display: grid;
      gap: 6px;
      position: relative;
      grid-template-columns: 1fr auto;
      grid-template-areas:
        "art art"
        "name icon"
        "label icon"
        "status status";
    }

    .food-target.sated {
      border-color: var(--success);
      box-shadow: 0 0 0 3px rgba(138, 198, 164, 0.3);
    }

    .food-target.mistake {
      border-color: var(--danger);
      box-shadow: 0 0 0 3px rgba(244, 135, 109, 0.25);
    }

    .food-target.overfed {
      border-color: var(--danger);
      box-shadow: 0 0 0 3px rgba(244, 135, 109, 0.35);
      background: rgba(244, 135, 109, 0.08);
    }

    .food-icon {
      font-size: 2rem;
      grid-area: icon;
    }

    .food-target .food-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      grid-area: label;
      justify-self: start;
    }

    .food-target .food-status {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text);
      grid-area: status;
      text-align: center;
    }

    .food-target.sated .food-status {
      color: var(--success);
    }

    .food-target.overfed .food-status {
      color: var(--danger);
    }

    .food-avatar {
      grid-area: art;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .food-avatar .cow-art-mini {
      max-width: 140px;
    }

    .food-target strong {
      grid-area: name;
      justify-self: start;
    }
    .food-chip-tray {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .food-chip {
      background: var(--accent-contrast);
      border: 2px solid var(--accent);
      border-radius: 14px;
      padding: 0.4rem 0.9rem;
      font-size: 1.3rem;
      cursor: grab;
      touch-action: none;
      position: relative;
    }

    .food-chip.dragging {
      cursor: grabbing;
      z-index: 50;
      position: fixed;
      pointer-events: none;
      opacity: 0.9;
    }

    .brush-board {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      min-height: 280px;
    }

    .brush-cow {
      position: relative;
      width: min(420px, 100%);
      aspect-ratio: 1.2 / 1;
      border-radius: 24px;
      background: linear-gradient(180deg, #fef9f4, #f8e7d7);
      border: 2px solid rgba(53, 38, 77, 0.12);
      overflow: hidden;
    }

    .brush-patch {
      position: absolute;
      width: 48px;
      height: 48px;
      background: rgba(53, 38, 77, 0.3);
      border-radius: 50%;
      transition: opacity 0.2s ease, transform 0.3s ease;
      pointer-events: none;
      mix-blend-mode: multiply;
    }

    .brush-patch.clean {
      opacity: 0;
      transform: scale(1.4);
    }

    .sparkle {
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%);
      animation: sparkle 0.6s ease forwards;
      pointer-events: none;
    }

    @keyframes sparkle {
      from { opacity: 1; transform: scale(0.6); }
      to { opacity: 0; transform: scale(1.8); }
    }

    .ceilidh-stage {
      width: 100%;
      max-width: 460px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      text-align: center;
    }

    .ceilidh-prompt {
      font-size: 1.1rem;
      font-weight: 600;
      padding: 0.7rem 1.2rem;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.82);
      border: 2px solid rgba(53, 38, 77, 0.14);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, border-color 0.2s ease;
      color: var(--text);
    }

    .ceilidh-prompt.active {
      transform: scale(1.05);
      background: rgba(138, 198, 164, 0.18);
      border-color: rgba(138, 198, 164, 0.5);
      box-shadow: 0 0 0 6px rgba(138, 198, 164, 0.25);
    }

    .ceilidh-prompt.miss {
      background: rgba(244, 135, 109, 0.18);
      border-color: rgba(244, 135, 109, 0.5);
      box-shadow: 0 0 0 6px rgba(244, 135, 109, 0.25);
    }

    .ceilidh-score {
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    .ceilidh-tap {
      padding: 0.75rem 2.6rem;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 999px;
      background: var(--accent);
      color: #fff;
      border: none;
      cursor: pointer;
      box-shadow: 0 14px 24px rgba(53, 38, 77, 0.22);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .ceilidh-tap:active {
      transform: translateY(1px);
      box-shadow: 0 10px 18px rgba(53, 38, 77, 0.2);
    }

    .ceilidh-tap:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    body.high-contrast .ceilidh-prompt,
    body.hc-high-contrast .ceilidh-prompt {
      background: var(--bg);
      border: 2px solid var(--outline);
      box-shadow: none;
    }

    body.high-contrast .ceilidh-prompt.active,
    body.hc-high-contrast .ceilidh-prompt.active {
      border-color: var(--success);
    }

    body.high-contrast .ceilidh-prompt.miss,
    body.hc-high-contrast .ceilidh-prompt.miss {
      border-color: var(--danger);
    }

    body.high-contrast .ceilidh-tap,
    body.hc-high-contrast .ceilidh-tap {
      background: var(--accent-contrast);
      color: var(--accent-strong);
      border: 2px solid var(--accent-strong);
      box-shadow: none;
    }

    .style-layout {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      align-items: start;
    }

    .style-preview {
      background: linear-gradient(180deg, rgba(242, 169, 183, 0.2), rgba(138, 198, 164, 0.18));
      border-radius: 24px;
      border: 2px solid rgba(53, 38, 77, 0.1);
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 240px;
      flex-direction: column;
    }

    .style-preview-art {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
    }

    .cow-art-large {
      max-width: 280px;
      width: 100%;
    }

    .style-accessories {
      display: grid;
      gap: 12px;
    }

    .style-list {
      display: grid;
      gap: 10px;
    }

    .style-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.8);
      border-radius: 14px;
      padding: 8px 12px;
      border: 1px solid rgba(53, 38, 77, 0.1);
    }

    .style-item button {
      padding: 0.35rem 0.9rem;
      font-size: 0.85rem;
    }

    .style-item button.active {
      background: var(--success);
      color: #fff;
      box-shadow: none;
    }

    .style-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .style-actions .ghost {
      flex: 1 1 160px;
      text-align: center;
    }
    .decor-manage-list {
      display: grid;
      gap: 10px;
    }

    .decor-manage-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(138, 198, 164, 0.18);
      border: 1px solid rgba(138, 198, 164, 0.4);
    }

    .decor-manage-item input {
      width: 18px;
      height: 18px;
    }

    .decor-manage-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      align-items: start;
    }

    .decor-preview {
      border-radius: 24px;
      border: 2px solid rgba(53, 38, 77, 0.08);
      background: rgba(255,255,255,0.6);
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 220px;
    }

    .decor-preview .decor-display {
      width: 100%;
      min-height: 0;
    }

    .decor-slot-control {
      display: grid;
      gap: 6px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(138, 198, 164, 0.15);
      border: 1px solid rgba(138, 198, 164, 0.35);
    }

    .decor-slot-control select {
      border-radius: 12px;
      border: 1px solid rgba(53, 38, 77, 0.2);
      padding: 8px 10px;
      background: #fff;
      font-size: 0.95rem;
    }

    .summary-list {
      display: grid;
      gap: 12px;
    }

    .summary-item {
      padding: 12px 16px;
      border-radius: 18px;
      background: rgba(242, 169, 183, 0.12);
      border: 2px solid rgba(53, 38, 77, 0.08);
    }

    .summary-cow-deltas {
      display: grid;
      gap: 8px;
    }

    .summary-cow {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      font-size: 0.95rem;
      background: rgba(255,255,255,0.9);
      border-radius: 16px;
      padding: 10px 14px;
      border: 1px solid rgba(53, 38, 77, 0.08);
    }

    .unlock-banner {
      padding: 16px;
      border-radius: 16px;
      background: rgba(138, 198, 164, 0.2);
      border: 2px dashed rgba(138, 198, 164, 0.6);
      font-weight: 600;
      color: var(--text);
    }

    .unlock-banner .unlock-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .unlock-banner .unlock-reason {
      margin-top: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text);
    }
    details.howto summary {
      cursor: pointer;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text);
    }

    details.howto {
      background: rgba(255, 255, 255, 0.55);
      border-radius: 20px;
      padding: 14px 18px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(8px);
      box-shadow: 0 18px 36px rgba(53, 38, 77, 0.12);
    }

    body.high-contrast details.howto,
    body.hc-high-contrast details.howto {
      background: var(--bg);
      border: 2px solid var(--outline);
      backdrop-filter: none;
      box-shadow: none;
    }

    @media (max-width: 640px) {
      body {
        padding: 12px;
      }
      .scene-decoration {
        top: -140px;
        left: -160px;
        width: calc(100% + 320px);
        height: 220px;
      }
      main {
        padding: 18px;
      }
      .task-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
